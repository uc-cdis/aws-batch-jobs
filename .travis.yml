language: python
dist: xenial
python:
  - 3.9
  - 3.10
  - 3.11
  - 3.12

cache: pip

install:
- pip install poetry
- poetry install -vv --no-interaction
- poetry show -vv
script:
- poetry run pytest -vv ./test
before_deploy:
- poetry config http-basic.pypi $PYPI_USER $PYPI_PASSWORD
- poetry build

deploy:
  provider: script
  script: poetry publish
  on:
    python: 3.9
    repo: uc-cdis/aws-batch-jobs
    tags: true
after_deploy:
- poetry run pip install gen3git
- poetry run gen3git release

env:
  global:
  - PIPENV_IGNORE_VIRTUALENVS=1
